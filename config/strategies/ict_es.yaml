# ICT Strategy Configuration for ES (E-mini S&P 500 Futures)
#
# This configuration file contains parameters for running the ICT strategy
# on ES futures. Includes session times, signal thresholds, risk parameters,
# and instrument-specific settings optimized for S&P 500 futures.
#
# ES is generally less volatile than NQ, so risk limits can be slightly higher.

# =============================================================================
# Strategy Identification
# =============================================================================

name: "ICT_ES_Strategy"
version: "1.0.0"
description: "ICT methodology applied to E-mini S&P 500 futures"

# =============================================================================
# Feature Toggles
# =============================================================================
# Enable/disable major strategy components for testing

# Session filter - only trade during killzones (NY Open, London)
enable_session_filter: false

# Use full ICT state machine flow:
# swingFound → liquidityDefined → sweepConfirmed → displacement → MSS → BOS → CISD → FVG → Entry
use_state_machine: true

# Individual component toggles
require_sweep: false
require_displacement: true
require_mss: false  # Disabled - using BOS/CISD instead
require_bos: true
require_cisd: true
require_fvg_after_cisd: true

# =============================================================================
# Proactive Liquidity Detection
# =============================================================================
# Use pre-identified key levels instead of reactive swing detection
use_proactive_levels: true

# Key levels to watch for sweeps
enable_pdh_pdl: true          # Previous Day High/Low
enable_overnight_levels: true  # Overnight/Globex High/Low
enable_opening_range: false    # Opening Range High/Low - DISABLED (can be traps within larger moves)
opening_range_minutes: 15      # Minutes for opening range calculation

# Swing detection (backup when key levels not available)
swing_left_bars: 2   # Reduced from 3 for faster detection
swing_right_bars: 1  # Minimal confirmation

# Lookback settings
lookback_bars: 200   # Increased to support key level calculation (needs ~400 bars for 2 days)

# =============================================================================
# FVG Retest Mode
# =============================================================================
# Enable trading FVG retests - when price returns to fill an FVG created
# during a displacement move, enter in the direction of the displacement.
#
# Example: Bearish displacement at 13:10 creates FVG at 6964-6965
#          Price rallies back to 6965 at 14:24
#          Enter SHORT on the FVG retest

enable_fvg_retest: true

# Minimum displacement body size to create a "retest-worthy" FVG
retest_min_displacement_ticks: 8

# Maximum bars an FVG remains valid for retest entry
retest_fvg_max_age_bars: 60

# Minimum distance price must move away before retest is valid (in ticks)
# Prevents entering on immediate continuation
retest_min_move_away_ticks: 4

# Only allow retest after price moves X% of displacement range away
retest_min_move_away_pct: 50

# =============================================================================
# Displacement Settings
# =============================================================================
# Minimum displacement candle body size in ticks
min_displacement_ticks: 4

# Minimum body-to-range ratio for displacement (0.0-1.0)
min_body_ratio: 0.6

# =============================================================================
# Liquidity Settings
# =============================================================================
# Ticks to cluster nearby swing points as same liquidity zone
liquidity_cluster_ticks: 4

# Buffer ticks beyond liquidity level to confirm sweep
sweep_buffer_ticks: 1

# =============================================================================
# Structure Settings
# =============================================================================
# Lookback bars for MSS detection
mss_lookback_bars: 20

# =============================================================================
# Trend Filter (EMA Crossover) - DISABLED, using ICT Premium/Discount instead
# =============================================================================
enable_trend_filter: false

# =============================================================================
# ICT Premium/Discount Filter
# =============================================================================
# Only take trades aligned with ICT premium/discount zones
# - LONG only in Discount zone (below 50% of session range)
# - SHORT only in Premium zone (above 50% of session range)
# This ensures we buy low and sell high based on session context

enable_premium_discount_filter: true
pd_lookback_bars: 100         # Bars to calculate range (session context)
pd_buffer_pct: 5              # Buffer % around midpoint (avoid signals right at 50%)

# =============================================================================
# Timeout Settings (in bars) - BALANCED for signal quality
# =============================================================================
# Max bars to wait for each stage after the previous
sweep_timeout_bars: 30      # Allow time for setup to develop
displacement_timeout_bars: 2 # Quick displacement detection
mss_timeout_bars: 5         # MSS detection window
bos_timeout_bars: 10        # BOS can take time after sweep
cisd_timeout_bars: 8        # CISD confirmation window
fvg_timeout_bars: 15        # FVG entry window
max_bars_sweep_to_bos: 20   # Give more time for reversal after key level sweep

# =============================================================================
# Timezone Configuration
# =============================================================================
# All times in this config are in Eastern Time (America/New_York).
# The system automatically handles US daylight saving time transitions.

timezone: "America/New_York"

# =============================================================================
# Killzone Configuration
# =============================================================================
# Killzones are specific time windows where ICT setups are most reliable.
# Trading is only allowed during enabled killzones.
#
# Times are in 24-hour format (HH:MM) in the timezone specified above.
# Start time is inclusive, end time is exclusive.

# Master toggle for London killzone
# Set to false if you only want to trade NY Open
enable_london_killzone: true

killzones:
  # New York Open Killzone
  # The highest probability window - US equity market open
  # High volume, institutional order flow, best liquidity
  NY_OPEN:
    enabled: true
    start: "09:30"
    end: "11:00"
    description: "NY equity market open - primary trading window"

  # London Killzone
  # European session start - good for overnight setups
  # Can catch moves before US traders wake up
  # Controlled by enable_london_killzone toggle above
  LONDON:
    enabled: true  # Also respects enable_london_killzone master toggle
    start: "02:00"
    end: "05:00"
    description: "London session open - European institutional flow"

# =============================================================================
# Instrument Specifications
# =============================================================================
# Contract specifications for ES (E-mini S&P 500)
# These values are fixed by the CME and should not be changed.

instrument:
  symbol: "ES"
  exchange: "CME"
  tick_size: 0.25          # Minimum price movement ($12.50 per tick)
  tick_value: 12.50        # Dollar value of one tick
  point_value: 50.00       # Dollar value of one point (4 ticks)
  contract_months: "HMUZ"  # March, June, September, December

# =============================================================================
# Risk Management
# =============================================================================
# Risk parameters specific to ES trading.
# ES is less volatile than NQ, allowing for slightly larger position sizes.

risk:
  # Maximum risk per trade as percentage of account
  max_risk_per_trade_pct: 1.0

  # Maximum number of contracts per trade
  # Adjust based on account size
  max_contracts: 4

  # Maximum daily loss before stopping (percentage of account)
  # ES is steadier, so we allow slightly more room
  max_daily_loss_pct: 3.0

  # Maximum number of trades per day
  max_trades_per_day: 20

  # Maximum number of consecutive losses before pausing
  max_consecutive_losses: 2

  # Minimum risk/reward ratio required for a trade
  min_risk_reward: 2.0

# =============================================================================
# Signal Parameters
# =============================================================================
# Thresholds and settings for ICT signal detection.

signals:
  # Minimum FVG size in ticks to be considered valid
  # Smaller gaps may not provide enough edge
  fvg_min_size_ticks: 3

  # Number of bars to look back for swing high/low detection
  swing_lookback_bars: 10

  # Minimum sweep size in ticks to be considered valid
  # Price must exceed the level by at least this much
  sweep_min_ticks: 2

  # Require BOS confirmation after sweep before entry
  require_bos: true

  # Maximum bars to wait for BOS after sweep
  bos_timeout_bars: 5

# =============================================================================
# Target Calculation
# =============================================================================
# How to calculate take-profit levels.

targets:
  # Use FVG levels as targets
  use_fvg_targets: true

  # Use liquidity levels (swing highs/lows) as targets
  use_liquidity_targets: true

  # Default target distances in points (if no structural targets found)
  default_target_1_points: 4.0   # 16 ticks = $200 per contract
  default_target_2_points: 8.0   # 32 ticks = $400 per contract

  # Partial exit percentages at each target
  target_1_exit_pct: 50  # Take 50% off at first target
  target_2_exit_pct: 50  # Take remaining 50% at second target

# =============================================================================
# Stop Loss Configuration
# =============================================================================

stops:
  # Place stop beyond the swept level
  stop_beyond_sweep: true

  # Additional buffer beyond sweep level in ticks
  stop_buffer_ticks: 2

  # MINIMUM stop distance from entry in ticks (prevents tight stops)
  # ES typically needs 12-16 tick stops to survive normal volatility
  min_stop_ticks: 15

  # Cooldown zone - prevent re-entry within this many ticks of a recent entry
  # Prevents multiple entries in the same price area
  cooldown_zone_ticks: 10

  # Move to breakeven after reaching target 1
  move_to_breakeven: true

  # Trail stop after target 1 (in ticks behind price)
  trail_after_target_1: false
  trail_distance_ticks: 8
